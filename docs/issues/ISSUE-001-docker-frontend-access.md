# ISSUE-001: Docker 部署后前端无法访问

## 问题描述

**现象**: 
- Docker Compose 启动成功，所有容器状态 healthy
- `curl http://127.0.0.1:10080/` 返回 HTTP 200，响应正常
- 但浏览器无法访问 `http://127.0.0.1:10080` 或 `http://localhost:10080`

**环境**:
- macOS + Docker Desktop
- 端口映射: 0.0.0.0:10080->80/tcp

---

## 根因分析

### 1. 网络架构问题

```
浏览器请求流程:
┌─────────────┐     ┌──────────────────┐     ┌─────────────┐
│   浏览器     │────>│  Docker Desktop  │────>│  Nginx容器   │
│ (localhost) │     │ (虚拟机网络层)    │     │  (容器网络)  │
└─────────────┘     └──────────────────┘     └─────────────┘
        ↑                                          ↑
        │                                          │
   无法访问!                                   服务正常
```

**问题**: macOS Docker Desktop 使用虚拟机，端口绑定到虚拟机而非宿主机

### 2. 可能的原因

| 原因 | 说明 | 概率 |
|------|------|------|
| Docker Desktop 网络隔离 | macOS 上 Docker 运行在 Linux VM 中，网络隔离 | 高 |
| 防火墙阻止 | macOS 防火墙阻止外部访问 Docker 端口 | 中 |
| 端口绑定问题 | 端口只绑定到 IPv6 或特定接口 | 中 |
| Nginx 配置问题 | 缺少 host 配置或 listen 配置不当 | 低 |

### 3. 已排除的问题

- ✅ 容器状态: 全部 healthy
- ✅ 服务监听: `0.0.0.0:10080`
- ✅ HTTP 响应: curl 测试 200 OK
- ✅ Nginx 配置: 正确配置了 server 块

---

## 解决方案对比

### 方案 A: 使用 host.docker.internal (推荐)
修改 Nginx 代理配置，使用 `host.docker.internal` 访问后端

**优点**: 
- 标准做法，跨平台兼容
- 无需额外网络配置

**缺点**:
- 需要修改配置文件

### 方案 B: 使用 Docker Host 网络模式
`network_mode: host`

**优点**:
- 直接使用宿主机网络
- 性能更好

**缺点**:
- macOS/Windows 不支持
- 只适用于 Linux

### 方案 C: 端口映射到 127.0.0.1
明确绑定到 localhost 接口

**优点**:
- 简单直接

**缺点**:
- 可能需要防火墙配置

### 方案 D: 使用 Traefik/Nginx Proxy Manager
使用反向代理管理器

**优点**:
- 专业解决方案
- 支持域名访问

**缺点**:
- 增加复杂度
- 需要额外配置

---

## 推荐方案: 方案 A + 配置优化

### 核心修改
1. Nginx 配置添加 `host.docker.internal` 解析
2. 明确端口绑定到 `127.0.0.1:10080`
3. 添加 CORS 配置支持跨域
4. 检查防火墙设置

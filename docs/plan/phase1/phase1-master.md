# Phase 1: 数据基建层 - 主计划

> 阶段目标：建立完整的数据采集管道，确保数据质量  
> 计划工期：2周（10个工作日）  
> 里程碑：数据管道可用，每日自动采集>100只基金净值

---

## 一、阶段概述

### 1.1 交付物
1. MySQL数据库（10张核心表）
2. Python采集模块（akshare+临时表+校验）
3. 数据质量监控机制
4. 定时调度系统（APScheduler）

### 1.2 关键成功指标
| 指标 | 目标值 | 验证方式 |
|------|--------|----------|
| 数据采集成功率 | >95% | 日志统计 |
| 数据校验通过率 | >98% | 校验记录 |
| 数据延迟 | <2小时 | 更新日志 |

---

## 二、子计划清单

| 编号 | 名称 | 工期 | 前置依赖 | 负责人 |
|------|------|------|----------|--------|
| P1-01 | 数据库设计与初始化 | 3天 | - | 待定 |
| P1-02 | Python采集模块 | 5天 | P1-01 | 待定 |
| P1-03 | 数据质量与校验 | 3天 | P1-02 | 待定 |
| P1-04 | 定时调度与监控 | 2天 | P1-03 | 待定 |

### 依赖关系图
```
P1-01 ──► P1-02 ──► P1-03 ──► P1-04
 (3天)    (5天)     (3天)     (2天)
```

---

## 三、详细子计划

### P1-01: 数据库设计与初始化
📄 **执行计划**：[./P1-01-database.md](./P1-01-database.md)

**主要内容**：
- 创建10张核心表（fund_info/fund_nav/fund_metrics/fund_score/fund_manager/fund_holding/user_portfolio/trade_record/signal_history/data_update_log/tmp_fund_nav）
- 设计索引策略
- 初始化基础数据

**验收标准**：
- [ ] 所有表创建成功
- [ ] 索引生效
- [ ] 基金基础数据>1000条

---

### P1-02: Python采集模块
📄 **执行计划**：[./P1-02-python-collector.md](./P1-02-python-collector.md)

**主要内容**：
- akshare封装
- 基金列表采集
- 每日净值采集
- 持仓数据采集
- 临时表写入机制

**验收标准**：
- [ ] 采集>100只基金净值
- [ ] 支持增量更新
- [ ] 异常重试机制

---

### P1-03: 数据质量与校验
📄 **执行计划**：[./P1-03-data-quality.md](./P1-03-data-quality.md)

**主要内容**：
- 临时表机制
- 数据校验规则（净值范围/涨跌幅范围/完整性/重复性）
- 校验失败处理
- 数据合并到正式表

**验收标准**：
- [ ] 校验规则覆盖率100%
- [ ] 异常数据自动标记
- [ ] 合并操作幂等

---

### P1-04: 定时调度与监控
📄 **执行计划**：[./P1-04-scheduler.md](./P1-04-scheduler.md)

**主要内容**：
- APScheduler配置
- 每日采集任务（19:00）
- 指标计算任务（20:30）
- 更新日志记录
- 异常告警（钉钉/邮件）

**验收标准**：
- [ ] 定时任务按时触发
- [ ] 日志记录完整
- [ ] 异常自动告警

---

## 四、接口契约

### Python → MySQL
| 数据流 | 源表 | 目标表 | 频率 |
|--------|------|--------|------|
| 基金基础 | akshare | fund_info | 每周 |
| 每日净值 | akshare | tmp_fund_nav → fund_nav | 每日 |
| 持仓数据 | akshare | fund_holding | 每季 |

### 数据更新日志
```sql
-- Python写入，Java读取
INSERT INTO data_update_log (table_name, update_date, record_count, status)
VALUES ('fund_nav', '2026-02-28', 15000, 'SUCCESS');
```

---

## 五、风险与应对

| 风险 | 可能性 | 影响 | 应对 |
|------|--------|------|------|
| akshare接口变更 | 中 | 高 | 封装抽象层，预留切换逻辑 |
| 反爬封禁 | 低 | 中 | 控制频率<1次/秒，添加延迟 |
| 数据量大导致慢 | 低 | 中 | 预留分区表设计 |

---

## 六、检查点

| 检查点 | 时间 | 检查内容 |
|--------|------|----------|
| CP1-1 | Week 1 Day 3 | 数据库创建完成 |
| CP1-2 | Week 1 Day 5 | 基础采集可用 |
| CP1-3 | Week 2 Day 3 | 数据校验通过 |
| CP1-4 | Week 2 Day 5 | 定时调度稳定运行 |

---

**负责人**：待定  
**更新日期**：2026-02-28
